var api_ip="http://146.185.154.46:8099",api_login="http://146.185.154.46:9940",MachineAPP=function(){function e(){var t=this;if(this.minersNamesArray=[],this.all_mhs=0,this.all_temp=0,this.machine_quantity=0,this.numberOfDeadMachines=0,this.numberOfOverhiting=0,this.numberOfdeadCards=0,this.listOfdeadCards="",this.sortType="name",this.sortAliveData=[],this.sortDeadData=[],this.pins=[],this.addedPins=[],this.pinsSetting=[],this.revert=!0,this.changeWatch=!1,this.walletsList=[],this.configsList=[],e._instance)throw new Error("Error: Instantiation failed: Use MachineAPP.getInstance() instead of new.");e._instance=this,this.minersArray=[],$(document).ready(function(){return t.initHandlers()})}return e.prototype.initHandlers=function(){var e=this;this.isLogged(),this.fillConfigList(),this.fillWalletsList(),this.getMiners(),$(document).on("click","#navbarCollapse [data-target='#addMachine']",function(){return e.addMinersList()}),$(document).on("click","#logInButton",function(){return e.logIn()}),$(document).on("click",".reboot",function(t){return e.menageMachine(t)}),$(document).on("click",".restart",function(t){return e.menageMachine(t)}),$(document).on("click",".delete",function(t){return e.menageMachine(t)}),$(document).on("click",".on_off",function(t){return e.menageMachine(t)}),$(document).on("click",".hard-reset",function(t){return e.menageMachine(t)}),$(document).on("click",".editHardwareButton",function(){return e.editHardware()}),$(document).on("click",".wallet_menagment",function(){return e.fill_wallet_menagment()}),$(document).on("click",".config_menagment",function(){return e.fill_config_menagment()}),$(document).on("click","#changePinsNumber",function(){return e.changePinsNumber()}),$(document).on("click",".wallet_edit",function(t){return e.editWallet(t)}),$(document).on("click",".wallet_add",function(){return e.addWallet()}),$(document).on("click",".wallet_delete",function(t){return e.deleteWallet(t)}),$(document).on("click",".wallet_isDefault",function(t){return e.isDefaultWallet(t)}),$(document).on("click",".config_edit",function(t){return e.editConfig(t)}),$(document).on("click",".config_add",function(){return e.addConfig()}),$(document).on("click",".config_delete",function(){return e.deleteConfig()}),$("#addEditWallet").find(".btn-outline-success").on("click",function(){return e.walletAction()}),$("#addEditConfig").find(".btn-outline-success").on("click",function(){return e.configAction()}),$(document).on("click",".menage_machine",function(){return e.changeWallet()}),$("#statistics").on("shown.bs.modal",function(){return e.statistics()}),this.sortHandlers(),$(".filter").on("keyup",function(){return e.filter()}),this.loadPinsSettings(function(){return e.enableHardButons()}),$("#editHardwareModal").on("click","#clearPins",function(){e.pinsSetting=[],e.generatePins(),$.ajax({type:"POST",url:api_ip+"/arduino/pins/clear",header:{authentication:e.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json"}),e.renderMachinesResetOptions(),e.renderPins()}),this.refreshTemperatureDate(),setInterval(function(){return e.refreshResetTime()},1e3)},e.getInstance=function(){return e._instance},e.prototype.isLogged=function(){this.cookie=JSON.parse(Cookies.get("authentication")),$.ajax({url:api_login+"/rest/logged",type:"get",contentType:"application/json",Authorization:"Bearer "+this.cookie.access_token,dataType:"json"}).done(function(e){console.log("respond: ",e)})},e.prototype.logIn=function(){var e=this,t=$("#logInNick").val(),n=$("#logInPassword").val();$.ajax({type:"POST",url:api_login+"/oauth2/token",crossDomain:!0,dataType:"json",contentType:"application/json",data:JSON.stringify({grant_type:"password",username:t,password:n,client_id:"testclient",client_secret:"testpass"})}).done(function(t){Cookies.set("authentication",JSON.stringify(t),{expiry:t.expires_in}),e.cookie=JSON.parse(Cookies.get("authentication"))})},e.prototype.filter=function(){var e=$(".filter:focus").val();if($(".filter").each(function(){$(".filter").val(e)}),""!=e)for(var t=0,n=this.minersNamesArray;t<n.length;t++){var a=n[t];-1==a.indexOf(e)?$("#machine_"+a).parent().hide():$("#machine_"+a).parent().show()}else for(var i=0,r=this.minersNamesArray;i<r.length;i++){var s=r[i];$("#machine_"+s).parent().show()}},e.prototype.sortHandlers=function(){var e=this;$(".sortByName").on("click",function(){$(".sortByDropdown .active").removeClass("active"),$(".sortByName").addClass("active"),e.sortType="name",e.sortBy(e.sortType)}),$(".sortByRunning").on("click",function(){$(".sortByDropdown .active").removeClass("active"),$(".sortByRunning").addClass("active"),e.sortType="runTime",e.sortBy(e.sortType)}),$(".sortByMh").on("click",function(){$(".sortByDropdown .active").removeClass("active"),$(".sortByMh").addClass("active"),e.sortType="mh",e.sortBy(e.sortType)}),$(".sortByTemp").on("click",function(){$(".sortByDropdown .active").removeClass("active"),$(".sortByTemp").addClass("active"),e.sortType="heat",e.sortBy(e.sortType)})},e.prototype.sortBy=function(e){var t=!0;"runTime"!=e&&"mh"!=e&&"heat"!=e||(t=!1),this.sortAliveData.sort(function(n,a){return n[e]<a[e]?t?-1:1:n[e]>a[e]?t?1:-1:0}),this.sortDeadData.sort(function(e,n){return e[name]<n[name]?t?-1:1:e[name]>n[name]?t?1:-1:0});for(var n=$("#machine_container"),a=$("#dead_machine_container"),i=0,r=this.sortAliveData;i<r.length;i++){var s=r[i];n.append($("#machine_"+s.name).parent())}for(var o=0,d=this.sortDeadData;o<d.length;o++){s=d[o];a.append($("#machine_"+s.name).parent())}},e.prototype.addMinersList=function(){var e=this;$.ajax({url:api_ip+"/clients/disconected",type:"get",dataType:"json"}).done(function(t){$("#addMachine").removeClass("d-none"),$("#addMachine .modal-body").text(" ");for(var n=$(".addMachineList").clone(),a=0,i=t;a<i.length;a++){var r=i[a];""!=r&&(n.find(".machinesToAdd").first().attr("id","machineToAdd_"+r),n.find(".nameToAdd").text(r),n.find(".machinesToAdd").first().removeClass("d-none").addClass("d-flex"),$("#addMachine .modal-body").append(n.html()))}e.addMachine(),""!=t[0]&&0!=t.length||$("#addMachine .modal-body").text("No machines to add")}).fail(function(){$("#addMachine").addClass("d-none")})},e.prototype.refreshResetTime=function(){this.temperatureData},e.prototype.getMiners=function(){var e=this;$.ajax({url:api_ip+"/clients",type:"get",dataType:"json"}).done(function(t){$("#alert-infos").hasClass("d-none")||$("#alert-infos").addClass("d-none"),$("#dead_machine_container").text(""),$("#dead_machine_container").addClass("d-none"),$("#machine_container").text(""),e.minersArray=t,e.renderMiners(),setInterval(function(){e.refreshMinersData()},12e3),e.refreshMinersData()}).fail(function(){$("#alert-infos").removeClass("d-none"),$("#alert-infos").text("Error when try connect with machines")})},e.prototype.renderMiners=function(){for(var e=0,t=Object.keys(this.minersArray);e<t.length;e++){var n=t[e],a=$("#template_machine>").clone();a.find(">div").addClass("miner"),a.find(">div").first().attr("id","machine_"+n),this.minersNamesArray.push(n),a.find(">div").first().attr("data-id",n),a.find(".miner_name").text(this.minersArray[n].MinerName),$("#machine_container").append(a)}$(".editHardwareButton").addClass("d-md-flex")},e.prototype.refreshMinersData=function(){var e=this;$.ajax({url:api_ip+"/latest/stat",type:"get",dataType:"json"}).done(function(t){e.all_mhs=0,e.all_temp=0,e.machine_quantity=0,e.numberOfDeadMachines=0,$("#showIssues .overhiting").text(""),$("#showIssues .deadCards").text(""),$(".issuesButton").addClass("d-none"),$("#overhiting_counter").text(""),$("#deadCards_counter").text(""),$("#overhiting_span").addClass("d-none"),$("#deadCards_span").addClass("d-none"),$("#deadMachines_span").addClass("d-none"),e.overhiting_helper=" ",e.deadCards_helper=" ",e.listOfdeadCards=" ",e.numberOfOverhiting=0,e.numberOfdeadCards=0,e.sortAliveData=[],e.sortDeadData=[];for(var n=0,a=Object.keys(e.minersArray);n<a.length;n++){var i=a[n],r=e.minersArray[i],s=t.hardware[i];s=s=void 0===s?null:JSON.parse(t.hardware[i].gpuList),void 0!==t.miners[r.MinerName]&&null!==s?e.fillMiners("machine_"+i,t.miners[r.MinerName],s,t.config[i]):e.deadMiners("machine_"+i)}1==e.changeWatch&&e.sortBy(e.sortType),e.all_mhs=e.Round(e.all_mhs,0),e.all_temp=e.Round(e.all_temp/e.machine_quantity,0),$(document).find(".total_data").html("<span class='d-block d-md-inline-block'>Total:  "+e.all_mhs+"Mh/s | <span data-tooltip='yes' title='Averge temperature from all machines'>"+e.all_temp+"&#186C | </span></span><span data-tooltip='yes' title='Working machines'> Machines: <img src='style/icons/icon_machine_works.svg' alt='Working machines' width='20' height='15'/> "+e.machine_quantity+"</span><span data-tooltip='yes' title='Not working machines' > <img src='style/icons/icon_machine_not_works.svg' alt='Not working machines' width='20' height='15'/> "+e.numberOfDeadMachines),e.numberOfOverhiting+e.numberOfdeadCards+e.numberOfDeadMachines>0&&($(".issuesButton").removeClass("d-none"),$(".numberOfIssues").text("Issues("+(e.numberOfOverhiting+e.numberOfdeadCards+e.numberOfDeadMachines)+")")),$("[data-tooltip='yes']").tooltip({boundary:"window"}),e.changeWatch=!1}).fail(function(){console.log("Error when try refresh")})},e.prototype.Round=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n},e.prototype.measureTime=function(e){var t=moment.duration(e,"minutes").humanize(),n=moment.duration(e/60,"minutes").humanize(),a=moment.duration(e/120,"minutes").humanize();return/day/i.test(t)?t+" and "+n:t+" and "+a},e.prototype.fillMiners=function(e,t,n,a){var i=this;if(this.machine_quantity++,moment()-moment(t.Time)>9e4)return this.deadMiners(e),this.machine_quantity--,void $("#"+e).find(".miner_issues").text("Last log of machine is from "+moment(t.Time,"YYYYMMDDHHmmss").fromNow());$("#"+e+" .card-body>div").first().hasClass("dead_machine_container")&&(this.changeWatch=!0,$("#"+e+" .card-body").html($("#template_machine .card-body>").clone()),$("#machine_container").append($("#"+e).parent()),$("#dead_machine_container").find("#"+e).parent().remove()),$("#"+e).find(".miner_issues").text(""),"ETH"==a.Currency&&$("#"+e).find(".currency").html('<img src="style/icons/icon_eth.svg" alt="ETH Graphic"/>'+a.Currency),"ETC"==a.Currency&&$("#"+e).find(".currency").html('<img src="style/icons/icon_etc.svg" alt="ETC Graphic"/>'+a.Currency),$("#"+e).find(".wallet").text(" "+a.WalletName);var r=e.replace("machine_","");$("#"+e).find(".miner_name").text(r);for(var s,o=t.DetailedEthHashRatePerGPU.split(";"),d=t.Temperatures.split(";"),l=0,c=0,p=0,f=0;f<o.length;f++)$("#"+e+" #gpus_container").find(".row").hasClass("card-"+f)||$("#"+e+" #gpus_container").append($("#gpus_template_element>div").clone().addClass("card-"+f)),(s=$("#"+e+" .card-"+f)).find(".gpu_name").text("GPU"+f),s.find(".gpu_mhs").text(this.Round(o[f]/1024,1)),s.find(".gpu_temp").html(d[l]+" &#186C"),c+=parseInt(d[l]),p<parseInt(d[l])&&(p=parseInt(d[l])),this.checkingErrors(s,d[l],e,"GPU"+f,this.Round(o[f]/1024,1)),s.find(".switch_change_id").attr("id",e+"_switch_"+f),s.find(".switch_label").attr("for",e+"_switch_"+f),s.find(".switch_change_id_mobile").attr("id",e+"_switch_mobile_"+f),s.find(".switch_label_mobile").attr("for",e+"_switch_mobile_"+f),$("#"+e+" .card-"+f).find(".fan_select").addClass("fan_select_"+r+"_"+f).attr({"data-miner":r,"data-gpu":f+1}).val(n[f+1].declaredFanSpeed).change(function(e){return i.fanSpeedChanged(e)}),s.find(".fan_speed").addClass("fan_speed_"+r+"_"+f),s.find(".fan_speed_"+r+"_"+f).text(n[f+1].fanSpeed),l+=2;$("#"+e).find(".collapseButton").click(function(e){$(e.currentTarget).parents(".mobile").find(".h-0").hasClass("show")?($(e.currentTarget).parents(".mobile").find(".h-0").removeClass("show"),$(e.currentTarget).parents(".mobile").find(".collapseArrow").css("transform","rotate(360deg)")):($(e.currentTarget).parents(".gpus_container").find(".collapseArrow").css("transform","rotate(360deg)"),$(e.currentTarget).parents(".gpus_container").find(".show").removeClass("show"),$(e.currentTarget).parents(".mobile").find(".h-0").addClass("show"),$(e.currentTarget).parents(".mobile").find(".collapseArrow").css("transform","rotate(180deg)"))}),c=this.Round(c/o.length,0);var m=this.Round(t.TotalEthHashRate/1024,1),u=t.EthShares,h=this.measureTime(t.RunningTime);this.all_mhs+=m,this.all_temp+=c,$("#"+e).find(".miner_total_shares").text(u),$("#"+e).find(".miner_total_mhs").text(m),$("#"+e).find(".miner_total_temp").html(p+" &#186C"),$("#"+e).find(".miner_total_time").text("Start running from: "+h),$("#overhiting_counter").text("("+this.numberOfOverhiting+")"),$("#deadCards_counter").text("("+this.numberOfdeadCards+")"),this.enableHardButons(),this.sortAliveData.push({name:r,heat:p,mh:m,runTime:t.RunningTime})},e.prototype.enableHardButons=function(){$(".hard-reset, .on_off").addClass("d-none");for(var e=0;e<this.pinsSetting.length;e++)null!=this.pinsSetting[e].Function&&$("#machine_"+this.pinsSetting[e].MinerName+" ."+(0==this.pinsSetting[e].Function?"hard-reset":"on_off")).removeClass("d-none")},e.prototype.fanSpeedChanged=function(e){$.ajax({type:"POST",url:api_ip+"/fans",header:{authentication:this.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json",data:JSON.stringify({id:e.target.dataset.gpu,machine:e.target.dataset.miner,speed:e.target.value})})},e.prototype.deadMiners=function(e){$("#deadMachines_span").removeClass("d-none"),$("#showIssues .deadMachines").removeClass("d-none");var t=$("#template_dead_machine").clone().html(),n=e.replace("machine_","");this.sortDeadData.push({name:n,heat:0,mh:0,runTime:0}),$("#"+e+" .card-body>div").first().hasClass("dead_machine_container")||(this.changeWatch=!0,$("#"+e+" .card-body").html(t),$("#dead_machine_container").append($("#"+e).parent()),$("#dead_machine_container").removeClass("d-none"),$("#machine_container").find("#"+e).parent().remove()),$("#"+e).find(".miner_name").text(n),$("#"+e).find(".miner_issues").text("No information about machine in database"),this.numberOfDeadMachines++,this.listOfdeadCards+=n+" ",$("#deadMachines_counter").text("("+this.numberOfDeadMachines+")"),$(".deadMachines").text(this.listOfdeadCards)},e.prototype.checkingErrors=function(e,t,n,a,i){$(e).find(".card-status").removeClass("bg-primary bg-dark bg-success bg-warning bg-danger text-dark"),$(e).find(".row").removeClass("alert-dark text-dark"),$(e).find(".gpu_info").text("");var r=n.replace("machine_","");0==t&&($(e).find(".card-status").addClass("bg-secondary"),this.deadCards_stat(e,r,a)),t>0&&t<=50&&$(e).find(".card-status").addClass("bg-primary"),t>50&&t<=65&&$(e).find(".card-status").addClass("bg-success"),t>65&&t<=75&&$(e).find(".card-status").addClass("bg-warning"),t>75&&t<=85&&($(e).find(".card-status").addClass("bg-danger"),$(e).addClass("alert-danger"),this.overhiting_stat(e,r,a)),t>85&&($(e).find(".card-status").addClass("bg-danger"),$(e).addClass("alert-danger"),this.overhiting_stat(e,r,a)),0==i&&this.deadCards_stat(e,r,a)},e.prototype.overhiting_stat=function(e,t,n){if($("#overhiting_span").removeClass("d-none"),$("#showIssues .overhiting").removeClass("d-none"),$(e).find(".gpu_info").html("<img src='style/icons/icon_fire.svg' alt='Fire!' width='15px' data-tooltip='yes' title='Card is burning!'/>"),this.overhiting_helper!=t){var a=$("<div>").text(t+": ").attr("href","#machine_"+t).attr("id","machine_"+t+"_overhiting");$("#showIssues .overhiting").append(a),$("#machine_"+t+"_overhiting").append(" "+n),this.overhiting_helper=t,this.numberOfOverhiting++}else $("#machine_"+t+"_overhiting").append(", "+n),this.numberOfOverhiting++},e.prototype.deadCards_stat=function(e,t,n){if($(e).find(".row").removeClass("alert-primary alert-dark alert-success alert-warning alert-danger bg-danger bg-secondary text-dark"),$(e).find(".row").addClass("alert-dark text-dark"),$(e).find(".gpu_info").html("<img src='style/icons/icon_dead.svg' alt='Dead card!' width='20px' data-tooltip='yes' title='Card disabled'/>"),$("#showIssues #deadCards_span").removeClass("d-none"),$("#showIssues .deadCards").removeClass("d-none"),!$(document).find(".deadCards").hasClass("d-none"))if(this.deadCards_helper!=t){var a=$("<div>").text(t+": ").attr("href","#machine_"+t).attr("id","machine_"+t+"_deadCards");$("#showIssues .deadCards").append(a),$("#machine_"+t+"_deadCards").append(" "+n),this.deadCards_helper=t,this.numberOfdeadCards++}else $("#machine_"+t+"_deadCards").append(" "+n),this.numberOfdeadCards++},e.prototype.addMachine=function(){var e=this;$("#addMachine").find(".buttonToAdd").on("click",function(t){var n=t.currentTarget.parentElement,a=n.id.replace("machineToAdd_","");$.ajax({type:"POST",url:api_ip+"/client",header:{authentication:e.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json",data:JSON.stringify({Name:a})}),n.remove(),e.getMiners()})},e.prototype.menageMachine=function(e){var t=this,n=$(e.target),a=n.parents(".miner").attr("data-id");n.hasClass("delete")||n.hasClass("hard-reset")||n.hasClass("on_off")?$("#confirmOperation .input-group").addClass("d-none"):$("#confirmOperation .input-group").removeClass("d-none"),n.hasClass("on_off")?($(".TurnOff, .TurnOn").removeClass("d-none"),$(".confirm_operation").addClass("d-none")):($(".TurnOff, .TurnOn").addClass("d-none"),$(".confirm_operation").removeClass("d-none")),$("#confirmOperation").find(".btn-primary").on("click",function(){var e=$("#reason_of_management").val();n.hasClass("reboot")&&$.ajax({type:"POST",url:api_ip+"/reboot",header:{authentication:t.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json"}),n.hasClass("restart")&&$.ajax({type:"POST",url:api_ip+"/restart",header:{authentication:t.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json",data:JSON.stringify({MinerName:a,reason:e})}),n.hasClass("delete")&&$.ajax({type:"POST",url:api_ip+"/client/delete",header:{authentication:t.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json",data:JSON.stringify({Name:a})}),n.hasClass("hard-reset")&&$.ajax({type:"POST",url:api_ip+"/arduino/add_reset",header:{authentication:t.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json",data:JSON.stringify({MachineName:a,Function:"reset"})}),$("#confirmOperation").modal("hide"),$("#reason_of_management").val(""),$("#confirmOperation").find(".btn-primary").unbind("click")}),$("#confirmOperation").find(".TurnOff").on("click",function(){$.ajax({type:"POST",url:api_ip+"/arduino/add_reset",header:{authentication:t.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json",data:JSON.stringify({MachineName:a,Function:"shutdown"})})}),$("#confirmOperation").find(".TurnOn").on("click",function(){$.ajax({type:"POST",url:api_ip+"/arduino/add_reset",header:{authentication:t.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json",data:JSON.stringify({MachineName:a,Function:"poweron"})})})},e.prototype.statistics=function(){var e=this.temperatureData;$(".t1").text(e.last.t1),$(".t2").text(e.last.t2),$(".v1").text(e.last.h1),$(".v2").text(e.last.h2),$(".last-time").text(moment(e.last.t_formated).format("MMM D HH:mm")),this.refreshGraph(e.data)},e.prototype.refreshTemperatureDate=function(){var e=this,t=api_ip.split(":");$.get(t[0]+":"+t[1]+"/api.php",function(t){e.temperatureData=t,e.temperatureData.last.l+=1e4})},e.prototype.refreshGraph=function(e){var t=e.map(function(e){return{x:new Date(parseInt(e.t+"000")),y:e.t1}}),n=e.map(function(e){return{x:new Date(parseInt(e.t+"000")),y:e.t2}});new Chartist.Line(".chart-cs",{series:[{name:"Sensor 1",data:t},{name:"Sensor 2",data:n}]},{axisX:{type:Chartist.FixedScaleAxis,divisor:6,labelInterpolationFnc:function(e){return moment(e).format("MMM D HH")+":00"}},plugins:[Chartist.plugins.tooltip({transformTooltipTextFnc:function(e){var t=e.split(",");return t[1]+"&#186C</br><small>"+moment(parseInt(t[0])).format("HH:mm")+"</small>"}})]})},e.prototype.loadPinsSettings=function(e){var t=this;$.get(api_ip+"/arduino/pins",function(n){n=n.filter(function(e){return null!=e.Function}),t.pinsSetting=n,"function"==typeof e&&e(n)})},e.prototype.editHardware=function(){var e=this;$("#failEditHardware").text(""),this.addedPins=[],$.ajax({url:api_ip+"/settings",type:"get",dataType:"json"}).done(function(t){e.pinsCount=parseInt(t.pinCount),$(".numberOfPins").val(t.pinCount),e.loadPinsSettings(function(){e.renderMachinesResetOptions(),$("#pinsHolder").droppable({drop:function(t,n){var a=parseInt(n.draggable[0].innerText);if(-1==e.pins.indexOf(a)){e.pins.push(a);var i=e.pinsSetting.findIndex(function(e){return e.ID==a});e.pinsSetting.splice(i,1),e.revert=!1,$(t.target).append(n.draggable[0]),$(n.draggable[0]).css({top:"initial",left:"initial"}),e.renderPins(),$.ajax({type:"POST",url:api_ip+"/arduino/pins",header:{authentication:e.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json",data:JSON.stringify({ID:a.toString(),MinerName:null,Function:null})})}}}),e.generatePins()})}).fail(function(){console.log("error when try to generate pins")})},e.prototype.renderPins=function(){var e=this,t=$("#pinsHolder").html("");this.pins.sort(function(e,t){return e-t});for(var n=0;n<this.pins.length;n++)t.append($("<span>").addClass("draggable bg-warning d-inline-block").text(this.pins[n]));$(".draggable").draggable({containment:".ui-widget-content",revert:function(){return e.revert},helper:"clone",start:function(){e.revert=!0}})},e.prototype.renderMachinesResetOptions=function(){var e=this,t=$(".minerPinsHolder");$(".minerPinsHolder").text(""),t.html("");for(var n=$("#machinesResetOptionsTemplate>div"),a=function(a){var r=i.pinsSetting.find(function(t){return t.MinerName==e.minersNamesArray[a]&&"0"==t.Function&&parseInt(t.ID)<=e.pinsCount}),s=i.pinsSetting.find(function(t){return t.MinerName==e.minersNamesArray[a]&&"1"==t.Function&&parseInt(t.ID)<=e.pinsCount}),o=$(n.clone());o.attr("data-miner",i.minersNamesArray[a]),o.find("label").text(i.minersNamesArray[a]),void 0!==r&&o.find(".reset").append($("<span style='position: relative; left: calc(50% - 17px); top: 2px;'>").addClass("draggable bg-warning d-inline-block").text(r.ID)),void 0!==s&&o.find(".power").append($("<span style='position: relative; left: calc(50% - 17px); top: 2px;'>").addClass("draggable bg-warning d-inline-block").text(s.ID)),t.append(o)},i=this,r=0;r<this.minersNamesArray.length;r++)a(r);$(".minerPinsHolder .droppable").droppable({drop:function(t,n){var a=n.draggable[0].innerText,i=t.target.parentNode.dataset.miner,r=$(t.target).hasClass("reset")?"0":"1";if(-1==e.pinsSetting.findIndex(function(e){return e.MinerName==i&&e.Function==r})){var s=e.pinsSetting.findIndex(function(e){return e.ID==a});-1!=s&&e.pinsSetting.splice(s,1),e.addedPins.push(a);var o={ID:a,MinerName:i,Function:r};e.pinsSetting.push(o),$.ajax({type:"POST",url:api_ip+"/arduino/pins",header:{authentication:e.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json",data:JSON.stringify(o)}),e.pins.splice(e.pins.findIndex(function(e){return e==parseInt(a)}),1),$(t.target).append(n.draggable[0]),e.revert=!1,e.enableHardButons(),$(n.draggable[0]).css({top:2,left:"calc(50% - 17px)",position:"relative"})}else e.revert=!0}})},e.prototype.generatePins=function(){this.pins=[];for(var e=function(e){-1==t.pinsSetting.findIndex(function(t){return t.ID==e.toString()&&null!=t.Function})&&t.pins.push(e),void 0!==t.pinsSetting[e]&&null!=t.pinsSetting[e].MinerName&&t.addedPins.push(t.pinsSetting[e].ID)},t=this,n=1;n<=this.pinsCount;n++)e(n);this.renderPins()},e.prototype.changePinsNumber=function(){for(var e=this,t=$(".numberOfPins").val(),n=0,a=0,i=this.pinsSetting;a<i.length;a++){var r=i[a];r.ID>n&&(n=r.ID)}n>t?$("#failEditHardware").text("A pin with a higher value has been already assigned"):($("#failEditHardware").text(""),$.ajax({type:"POST",url:api_ip+"/settings",header:{authentication:this.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json",data:JSON.stringify({Name:"pinCount",Value:t})}).done(function(){e.pinsCount=parseInt(t),e.generatePins(),e.renderMachinesResetOptions()}))},e.prototype.fillWalletsList=function(){var e=this;$.ajax({url:api_ip+"/wallet",type:"get",dataType:"json"}).done(function(t){e.walletsList=[];for(var n=0,a=t;n<a.length;n++){var i=a[n];e.walletsList.push({ID:i.ID,WalletName:i.WalletName,Address:i.Address,Currency:i.Currency,IsDefault:i.IsDefault})}}).fail(function(){console.log("Fail when try connect with wallets list")})},e.prototype.fill_wallet_menagment=function(){$("#wallets_menagment_container").text("");for(var e=0,t=this.walletsList;e<t.length;e++){var n=t[e],a=$("#walletManagmentTemplate > div").clone();a.attr("id","wallet_"+n.WalletName),a.attr("data-id",n.ID),$("#wallets_menagment_container").append(a),$("#wallet_"+n.WalletName).find(".wallet_name").text(n.WalletName),$("#wallet_"+n.WalletName).find(".wallet_address").text(n.Address),$("#wallet_"+n.WalletName).find(".wallet_currency").text(n.Currency),"ETH"==$("#wallet_"+n.WalletName).find(".wallet_currency").text()&&$("#wallet_"+n.WalletName).find(".wallet_isDefault").attr("name","wallet_radio_eth"),"ETC"==$("#wallet_"+n.WalletName).find(".wallet_currency").text()&&$("#wallet_"+n.WalletName).find(".wallet_isDefault").attr("name","wallet_radio_etc"),"1"===n.IsDefault&&$("#wallet_"+n.WalletName).find(".wallet_isDefault").attr("checked",!0)}},e.prototype.addWallet=function(){$("#addEditEditWallet").find(".modal-title").text("Add wallet"),$("#addEditWallet").attr("data-wallet-id","-1"),$("#addEditWalletErrors").hasClass("d-none")||$(".addEditWalletErrors").addClass("d-none"),$("#addEdit_wallet_name").val(""),$("#addEdit_wallet_address").val("")},e.prototype.editWallet=function(e){$("#addEditWallet").find(".modal-title").text("Edit wallet");var t=$(e.target).parents(".row");$("#addEditWallet").attr("data-wallet-id",t.attr("data-id")),$("#addEditWalletErrors").hasClass("d-none")||$(".addEditWalletErrors").addClass("d-none"),$("#addEdit_wallet_name").val($("#"+t.attr("id")).find(".wallet_name").text()),$("#addEdit_wallet_address").val($("#"+t.attr("id")).find(".wallet_address").text()),$("#addEdit_wallet_currency").val($("#"+t.attr("id")).find(".wallet_currency").text())},e.prototype.walletAction=function(){var e=this;if(""==$.trim($("#addEdit_wallet_address").val())||""==$.trim($("#addEdit_wallet_name").val()))$(".addEditWalletErrors").removeClass("d-none");else{var t=$("#addEditWallet").attr("data-wallet-id"),n=this.walletsList.findIndex(function(e){return e.ID==t}),a={WalletName:$("#addEdit_wallet_name").val(),Address:$("#addEdit_wallet_address").val(),Currency:$("#addEdit_wallet_currency").val(),IsDefault:-1==n?0:this.walletsList[n].IsDefault,ID:parseInt(t)};-1==n&&delete a.ID,$.ajax({type:"POST",url:api_ip+"/wallet",header:{authentication:this.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json",data:JSON.stringify(a)}).done(function(t){-1==n?(a.ID=parseInt(t),e.walletsList.push(a)):e.walletsList[n]=a,e.fill_wallet_menagment(),$("#addEditWallet").modal("hide")})}},e.prototype.deleteWallet=function(e){var t=this,n=$(e.target).parents(".row").attr("id");$(".wallet_error").text(""),$("#confirmOperation .input-group").addClass("d-none"),$("#confirmOperation .confirm_operation").on("click",function(){if($("#"+n).find(".wallet_isDefault").is(":checked"))$(".wallet_error").text("The default wallet can not be removed");else{var e=parseInt($("#addEditWallet").attr("data-wallet-id")),a=t.walletsList.findIndex(function(t){return t.ID==e});t.walletsList.splice(a,1),$.ajax({type:"POST",url:api_ip+"/wallet/delete",header:{authentication:t.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json",data:JSON.stringify({ID:e})}).done(function(){t.fill_wallet_menagment(),$("#confirmOperation").modal("hide"),$("#confirmOperation .confirm_operation").unbind("click")})}})},e.prototype.isDefaultWallet=function(e){var t=this,n=$(e.target).parents(".row").attr("id"),a=$(e.target).parents(".row").attr("data-id"),i=this.walletsList.findIndex(function(e){return e.ID==a}),r={Currency:$("#"+n).find(".wallet_currency").text(),ID:parseInt($("#"+n).attr("data-id"))};$.ajax({type:"POST",url:api_ip+"/wallet/set_default",header:{authentication:this.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json",data:JSON.stringify(r)}).done(function(){for(var e=0;e<t.walletsList.length;e++)r.Currency==t.walletsList[e].Currency&&(t.walletsList[e].IsDefault="0");t.walletsList[i].IsDefault="1"})},e.prototype.fillConfigList=function(){var e=this;$.ajax({url:api_ip+"/claymore/config/basic",type:"get",dataType:"json"}).done(function(t){e.configsList=[];for(var n=0,a=t;n<a.length;n++){var i=a[n];e.configsList.push({ID:i.id,ConfigName:i.name,Params:i.params,Currency:i.currency})}}).fail(function(){console.log("Fail when try connect with wallets list")})},e.prototype.fill_config_menagment=function(){$("#configs_menagment_container").text("");for(var e=0,t=this.configsList;e<t.length;e++){var n=t[e],a=$("#configManagmentTemplate > div").clone();a.attr("id","config_"+n.ConfigName),a.attr("data-id",n.ID),$("#configs_menagment_container").append(a),$("#config_"+n.ConfigName).find(".config_name").text(n.ConfigName),$("#config_"+n.ConfigName).find(".config_params").text(n.Params),$("#config_"+n.ConfigName).find(".config_currency").text(n.Currency),"ETH"==$("#config_"+n.ConfigName).find(".config_currency").text()&&$("#config_"+n.ConfigName).find(".config_isDefault").attr("name","config_radio_eth"),"ETC"==$("#config_"+n.ConfigName).find(".config_currency").text()&&$("#config_"+n.ConfigName).find(".config_isDefault").attr("name","config_radio_etc")}},e.prototype.addConfig=function(){$("#addEditEditConfig").find(".modal-title").text("Add config"),$("#addEditConfig").attr("data-config-id","-1"),$("#addEditConfigErrors").hasClass("d-none")||$(".addEditConfigErrors").addClass("d-none"),$("#addEdit_config_name").val(""),$("#addEdit_config_params").val("")},e.prototype.editConfig=function(e){$("#addEditConfig").find(".modal-title").text("Edit config");var t=$(e.target).parents(".row");$("#addEditConfig").attr("data-config-id",t.attr("data-id")),$("#addEditConfigErrors").hasClass("d-none")||$(".addEditConfigErrors").addClass("d-none"),$("#addEdit_config_name").val($("#"+t.attr("id")).find(".config_name").text()),$("#addEdit_config_params").val($("#"+t.attr("id")).find(".config_params").text()),$("#addEdit_config_currency").val($("#"+t.attr("id")).find(".config_currency").text())},e.prototype.configAction=function(){var e=this;if(""==$.trim($("#addEdit_config_params").val())||""==$.trim($("#addEdit_config_name").val()))$(".addEditConfigErrors").removeClass("d-none");else{var t=$("#addEditConfig").attr("data-config-id"),n={ID:parseInt(t),name:$("#addEdit_config_name").val(),Params:$("#addEdit_config_params").val(),Currency:$("#addEdit_config_currency").val()},a=this.configsList.findIndex(function(e){return e.ID==t});-1==a&&delete n.ID,$.ajax({type:"POST",url:api_ip+"/claymore/config/basic",header:{authentication:this.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json",data:JSON.stringify(n)}).done(function(i){if(-1==a)n.ID=parseInt(i),e.configsList.push(n);else{var r={ID:parseInt(t),ConfigName:$("#addEdit_config_name").val(),Params:$("#addEdit_config_params").val(),Currency:$("#addEdit_config_currency").val()};e.configsList[a]=r}e.fill_config_menagment(),$("#addEditConfig").modal("hide")})}},e.prototype.deleteConfig=function(){var e=this;$(".config_error").text(""),$("#confirmOperation .input-group").addClass("d-none"),$("#confirmOperation .confirm_operation").on("click",function(){var t=parseInt($("#addEditConfig").attr("data-config-id")),n=e.configsList.findIndex(function(e){return e.ID==t});e.configsList.splice(n,1),$.ajax({type:"POST",url:api_ip+"/claymore/config/basic/delete",header:{authentication:e.cookie.access_token},crossDomain:!0,dataType:"json",contentType:"application/json",data:JSON.stringify({ID:t})}),e.fill_config_menagment(),$("#confirmOperation").modal("hide"),$("#confirmOperation .confirm_operation").unbind("click")})},e.prototype.changeWallet=function(){$("#menage_machine").find(".change_config").text(""),$("#menage_machine").find(".change_wallet").text("");for(var e=0,t=this.configsList;e<t.length;e++){var n=t[e];$("#menage_machine").find(".change_config").append("<option>"+n.ConfigName+"</option>")}for(var a=0,i=this.walletsList;a<i.length;a++){n=i[a];$("#menage_machine").find(".change_wallet").append("<option>"+n.WalletName+"</option>")}},e._instance=new e,e}();